apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: myapp-secrets
  namespace: dev-myapp
  labels:
    app: myapp
    environment: dev
spec:
  refreshInterval: 1h # Sync every hour

  secretStoreRef:
    name: azure-keyvault
    kind: ClusterSecretStore

  target:
    name: myapp-secrets # Name of the K8s Secret to create
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: myapp
      data:
        # You can transform secrets here
        DATABASE_URL: "postgresql://user:{{ .password }}@db.example.com:5432/myapp"

  data:
    - secretKey: password # Key in the K8s Secret
      remoteRef:
        key: database-password # Key in Key Vault

    - secretKey: api-key
      remoteRef:
        key: external-api-key
